/* ── CSS Custom Properties ─────────────────────────────── */
:root {
  /* Bubbly node font — Fredoka (Google Fonts) */
  --font-bubble: 'Fredoka', system-ui, sans-serif;

  /* Luxury polychromatic palette — emerald / gold / silver / purple / crimson */
  --color-complete: #50c878;
  --color-started: #e2b93b;
  --color-notstarted: #a0a8b4;
  --color-planning: #9b72cf;
  --color-blocked: #dc3f52;
  --color-reviewing: #e8a317;

  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;
  --bg-tertiary: #334155;
  --text-primary: #f8fafc;
  --text-secondary: #e2e8f0;
  --text-tertiary: #cbd5e1;
  --text-muted: #a0a8b4;
  --text-dimmed: #64748b;
  --border-color: #334155;
  --border-subtle: rgba(148, 163, 184, 0.15);
  --accent-green: #50c878;
  --accent-green-dark: #0f172a;
  --toolbar-bg: rgba(15, 23, 42, 0.85);
  --sidebar-bg: rgba(15, 23, 42, 0.92);
  --hover-bg: rgba(148, 163, 184, 0.08);
  --hover-bg-strong: rgba(148, 163, 184, 0.1);
  --focus-ring: #4a90d9;
  --legend-bg: rgba(15, 23, 42, 0.9);
  --hint-bg: rgba(15, 23, 42, 0.7);
  --disabled-bg: #475569;

  /* Status dark variants (node fills) — deep luxury tones */
  --color-complete-dark: #1e6b3e;
  --color-started-dark: #a68520;
  --color-notstarted-dark: #4a5058;
  --color-planning-dark: #5e3d8f;
  --color-blocked-dark: #8f2233;
  --color-reviewing-dark: #a06b0f;

  /* UI chrome */
  --color-root-ring: #d4a017;
  --color-edge: #475569;
  --color-edge-dim: #64748b;
  --color-node-text-dark: #1e293b;
  --color-node-text-light: #e2e8f0;
  --color-text-shadow: rgba(0, 0, 0, 0.7);
  --color-tooltip-shadow: rgba(0, 0, 0, 0.4);

  /* Error colors — crimson */
  --color-error: #dc3f52;
  --color-error-text: #f2808d;
  --color-error-bg: rgba(220, 63, 82, 0.08);
  --color-error-border: rgba(220, 63, 82, 0.3);

  /* Accent — emerald */
  --color-accent-hover: rgba(80, 200, 120, 0.08);
  --color-accent-active: rgba(80, 200, 120, 0.1);
  --color-accent-subtle: rgba(80, 200, 120, 0.05);
  --color-code-bg: rgba(255, 255, 255, 0.05);
  --color-spinner-border: rgba(255, 255, 255, 0.3);
  --color-spinner-track: rgba(255, 255, 255, 0.05);
  --color-strata-line: rgba(148, 163, 184, 0.45);

  /* Vine edge colors — royal purple & emerald */
  --color-vine: #6a3d9a;
  --color-vine-leaf: #2e7d4f;

  /* Glass node effects */
  --color-glass-highlight: rgba(255, 255, 255, 0.28);
  --color-glass-highlight-soft: rgba(255, 255, 255, 0.08);
  --color-glass-inner-shadow: rgba(0, 0, 0, 0.35);

  /* Node label text — tuneable from one place */
  --node-font-size: 14;
  --node-font-weight: 400;
  --node-text-stroke-width: 0.5;
  --node-text-glow-radius: 2;
  --node-text-glow-opacity: 0.7;
  --node-gradient-mid-alpha: 0.85;
  --node-gradient-edge-alpha: 0.75;
  --node-specular-opacity: 0.35;
  --node-specular-radius: 25;
  --node-specular-cx: 35;
  --node-specular-cy: 22;
  --node-glass-cx: 38;
  --node-glass-cy: 25;
  --node-glass-lighten: 35;
  --node-inner-shadow-start: 70;

  color-scheme: dark;
}

[data-theme='light'] {
  --bg-primary: #e8f5f0;
  --bg-secondary: #dceee7;
  --bg-tertiary: #c8ddd2;
  --text-primary: #0f172a;
  --text-secondary: #1e293b;
  --text-tertiary: #475569;
  --text-muted: #64748b;
  --text-dimmed: #a0a8b4;
  --border-color: #b0c4b8;
  --border-subtle: rgba(100, 116, 139, 0.35);
  --accent-green: #1b8a4a;
  --accent-green-dark: #ffffff;
  --toolbar-bg: rgba(248, 250, 252, 0.85);
  --sidebar-bg: rgba(248, 250, 252, 0.95);
  --hover-bg: rgba(100, 116, 139, 0.08);
  --hover-bg-strong: rgba(100, 116, 139, 0.15);
  --focus-ring: #1e5aa8;
  --legend-bg: rgba(248, 250, 252, 0.92);
  --hint-bg: rgba(248, 250, 252, 0.8);
  --disabled-bg: #a0a8b4;

  /* Status dark variants (node fills) — vivid for light backgrounds */
  --color-complete-dark: #50c878;
  --color-started-dark: #d4a017;
  --color-notstarted-dark: #b0b8c0;
  --color-planning-dark: #9b72cf;
  --color-blocked-dark: #dc3f52;
  --color-reviewing-dark: #e8a317;

  /* UI chrome */
  --color-root-ring: #b8860b;
  --color-edge: #8a9ea6;
  --color-edge-dim: #b0c4b8;
  --color-node-text-dark: #1e293b;
  --color-node-text-light: #ffffff;
  --color-text-shadow: rgba(0, 0, 0, 0.3);
  --color-tooltip-shadow: rgba(0, 0, 0, 0.2);
  --color-strata-line: rgba(71, 85, 105, 0.45);

  /* Vine edge colors — emerald tones */
  --color-vine: #2e8b57;
  --color-vine-leaf: #2d6a3f;

  /* Glass node effects */
  --color-glass-highlight: rgba(255, 255, 255, 0.4);
  --color-glass-highlight-soft: rgba(255, 255, 255, 0.12);
  --color-glass-inner-shadow: rgba(0, 0, 0, 0.15);

  /* Node label text — light theme overrides */
  --node-text-glow-opacity: 0.5;
  --node-gradient-mid-alpha: 0.9;
  --node-gradient-edge-alpha: 0.8;
  --node-specular-opacity: 0.25;
  --node-specular-radius: 22;
  --node-specular-cx: 35;
  --node-specular-cy: 22;
  --node-glass-cx: 38;
  --node-glass-cy: 25;
  --node-glass-lighten: 30;
  --node-inner-shadow-start: 70;

  /* Error colors — crimson */
  --color-error: #c41e3a;
  --color-error-text: #a01830;
  --color-error-bg: rgba(196, 30, 58, 0.08);
  --color-error-border: rgba(196, 30, 58, 0.3);

  /* Accent — emerald */
  --color-accent-hover: rgba(27, 138, 74, 0.08);
  --color-accent-active: rgba(27, 138, 74, 0.12);
  --color-accent-subtle: rgba(27, 138, 74, 0.05);
  --color-code-bg: rgba(0, 0, 0, 0.05);
  --color-spinner-border: rgba(0, 0, 0, 0.3);
  --color-spinner-track: rgba(0, 0, 0, 0.05);

  color-scheme: light;
}

/* ── Base Reset ───────────────────────────────────────── */
*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body,
#app {
  height: 100%;
  margin: 0;
  padding: 0;
}

body {
  overflow: hidden;
  background: var(--bg-primary);
  color: var(--text-secondary);
  font-family: var(--font-bubble);
}

button,
input,
select,
textarea {
  font-family: inherit;
}

:focus-visible {
  outline: 2px solid var(--focus-ring);
  outline-offset: 2px;
}

/* ── Status Classes ───────────────────────────────────── */
.status-complete {
  fill: var(--color-complete);
  stroke: var(--color-complete);
}

.status-started {
  fill: var(--color-started);
  stroke: var(--color-started);
}

.status-notstarted {
  fill: var(--color-notstarted);
  stroke: var(--color-notstarted);
}

.status-planning {
  fill: var(--color-planning);
  stroke: var(--color-planning);
}

.status-blocked {
  fill: var(--color-blocked);
  stroke: var(--color-blocked);
}

.status-reviewing {
  fill: var(--color-reviewing);
  stroke: var(--color-reviewing);
}

/* ── Keyframe Animations ──────────────────────────────── */

/* Gentle vertical oscillation for node labels */
@keyframes label-bob {
  0%,
  100% {
    transform: translateY(-2px);
  }
  50% {
    transform: translateY(2px);
  }
}

/* Outer glow ring pulse for "started" nodes */
@keyframes glow-pulse {
  0%,
  100% {
    opacity: var(--vis-glow-pulse-min, 0.4);
  }
  50% {
    opacity: var(--vis-glow-pulse-max, 0.8);
  }
}

/* Rotating radial gradient shimmer for "complete" nodes */
/* SVG-compatible shimmer: subtle brightness pulse for complete nodes */
@keyframes completion-shimmer {
  0%,
  100% {
    filter: brightness(1);
  }
  50% {
    filter: brightness(1.3);
  }
}

/* Flowing dots along edges — 60px dashoffset over 2s = 30px/s */
@keyframes edge-flow {
  from {
    stroke-dashoffset: 60;
  }
  to {
    stroke-dashoffset: 0;
  }
}

/* Horizontal shake for error cards — 3 cycles in 300ms */
@keyframes error-shake {
  0%,
  100% {
    transform: translateX(0);
  }
  16.6% {
    transform: translateX(-4px);
  }
  33.3% {
    transform: translateX(4px);
  }
  50% {
    transform: translateX(-4px);
  }
  66.6% {
    transform: translateX(4px);
  }
  83.3% {
    transform: translateX(-4px);
  }
}

/* Gentle sway for vine leaf decorations */
@keyframes vine-leaf-sway {
  0%,
  100% {
    transform: rotate(calc(-1 * var(--vis-leaf-sway-angle, 3deg)));
  }
  50% {
    transform: rotate(var(--vis-leaf-sway-angle, 3deg));
  }
}

/* ── Animation Utility Classes ────────────────────────── */
.anim-label-bob {
  /* animation removed — continuous translateY + will-change caused GPU-layer
     rasterisation that destroyed SVG vector-text clarity (blurry labels) */
}

.anim-glow-pulse {
  animation: glow-pulse var(--vis-glow-pulse-duration, 2s) ease-in-out infinite;
}

.anim-completion-shimmer {
  animation: completion-shimmer var(--vis-shimmer-duration, 6s) linear infinite;
}

.anim-edge-flow {
  animation: edge-flow var(--vis-edge-flow-duration, 2s) linear infinite;
}

.anim-vine-leaf-sway {
  animation: vine-leaf-sway var(--vis-leaf-sway-duration, 4s) ease-in-out
    infinite;
  transform-origin: 0% 50%;
}

.anim-vine-tendril-sway {
  animation: vine-tendril-sway 5s ease-in-out infinite;
  transform-origin: 0 0;
}

@keyframes vine-tendril-sway {
  0%,
  100% {
    transform: rotate(-5deg);
  }
  50% {
    transform: rotate(5deg);
  }
}

.anim-error-shake {
  animation: error-shake 300ms ease-in-out;
}

/* ── Reduced Motion ───────────────────────────────────── */
@media (prefers-reduced-motion: reduce) {
  .anim-label-bob,
  .anim-glow-pulse,
  .anim-completion-shimmer,
  .anim-edge-flow,
  .anim-vine-leaf-sway,
  .anim-vine-tendril-sway,
  .anim-error-shake {
    animation: none !important;
  }
}
